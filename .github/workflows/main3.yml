name: Upload Release Assets


on:
  push:
   

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Pull Docker image
      run: docker pull sophgo/tpuc_dev:latest

    - name: Run Docker container
      run: |
        docker run --privileged --name myname1234 -v $PWD:/workspace sophgo/tpuc_dev:v2.2 /bin/bash -c "
        cd tpu-mlir

        ./release.sh
        "

    - name: Copy file from container
      run: docker cp myname1234:/workspace/tpu-mlir/tpu-mlir_v1.3.beta.0-20230816.tar.gz $GITHUB_WORKSPACE/

    - name: Upload Release Asset
      uses: actions/upload-release-asset@v1
      with:
         upload_url: ${{ github.event.release.upload_url }}
         asset_path: ./tpu-mlir_v1.3.beta.0-20230816.tar.gz
         asset_name: tpu-mlir_v1.3.beta.0-20230816.tar.gz
         asset_content_type: application/gzip
         token: ${{ secrets.TOKEN }}
